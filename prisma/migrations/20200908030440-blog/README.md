# Migration `20200908030440-blog`

This migration has been generated by Gustavo T. RÃ¼diger at 9/8/2020, 12:04:40 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TYPE "public"."UserRole" AS ENUM ('ADMIN', 'AUTHOR')

CREATE TYPE "public"."PostStatus" AS ENUM ('DRAFT', 'PUBLISHED')

DROP INDEX "public"."User.email_unique"

ALTER TABLE "public"."User" DROP CONSTRAINT "User_pkey",
DROP COLUMN "email",
DROP COLUMN "password",
DROP COLUMN "deletedAt",
ADD COLUMN "name" text   ,
ADD COLUMN "blogId" integer   ,
ADD COLUMN "rating" Decimal(65,30)   NOT NULL ,
ADD COLUMN "role" "UserRole"  NOT NULL ,
DROP COLUMN "id",
ADD COLUMN "id" SERIAL,
ALTER COLUMN "updatedAt" DROP DEFAULT,
ADD PRIMARY KEY ("id")

CREATE TABLE "public"."Blog" (
"id" SERIAL,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL ,
"name" text   NOT NULL ,
"viewCount" integer   NOT NULL DEFAULT 0,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Post" (
"id" SERIAL,
"title" text   NOT NULL ,
"blogId" integer   ,
"status" "PostStatus"  NOT NULL ,
"userId" integer   ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Tag" (
"id" SERIAL,
"value" text   NOT NULL ,
"postId" integer   ,
PRIMARY KEY ("id")
)

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("blogId")REFERENCES "public"."Blog"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."Tag" ADD FOREIGN KEY ("postId")REFERENCES "public"."Post"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."User" ADD FOREIGN KEY ("blogId")REFERENCES "public"."Blog"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200907233106-init..20200908030440-blog
--- datamodel.dml
+++ datamodel.dml
@@ -2,21 +2,62 @@
 // learn more about it in the docs: https://pris.ly/d/prisma-schema
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
+model Blog {
+  id        Int      @default(autoincrement()) @id
+  createdAt DateTime @default(now())
+  updatedAt DateTime @updatedAt
+  name      String
+  viewCount Int      @default(0)
+  posts     Post[]
+  authors   User[]
+}
+
 model User {
-  id String @default(cuid()) @id
-  email String @unique
-  password String
+  id        Int      @default(autoincrement()) @id
   createdAt DateTime @default(now())
-  updatedAt DateTime @default(now())
-  deletedAt DateTime? 
+  updatedAt DateTime @updatedAt
+  name      String?
+  posts     Post[]
+  blogId    Int?
+  blog      Blog?    @relation(fields: [blogId], references: [id])
+  rating    Float
+  role      UserRole
 }
+enum UserRole {
+  ADMIN
+  AUTHOR
+}
+model Post {
+  id     Int        @default(autoincrement()) @id
+  title  String
+  tags   Tag[]
+  blogId Int?
+  blog   Blog?      @relation(fields: [blogId], references: [id])
+  status PostStatus
+  userId Int?
+  user   User?      @relation(fields: [userId], references: [id])
+}
+
+enum PostStatus {
+  DRAFT
+  PUBLISHED
+}
+
+model Tag {
+  id     Int    @default(autoincrement()) @id
+  value  String
+  postId Int?
+  post   Post?  @relation(fields: [postId], references: [id])
+}
+
+
```


